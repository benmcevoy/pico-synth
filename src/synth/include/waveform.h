#ifndef SYNTH_WAVEFORM_
#define SYNTH_WAVEFORM_

#include "audiocontext.h"

#define WAVE_TABLE_LENGTH 512
#define FIX16_WAVE_TABLE_LENGTH 33554432

// TODO: probably should be set_frequency on voice?
static inline void synth_waveform_set_wavetable_stride(voice_t* voice, fix16 pitch_bend) {
  voice->wavetable_stride =
      multfix16(divfix16(multfix16(voice->frequency, pitch_bend + voice->detune),
                         FIX16_SAMPLE_RATE),
                FIX16_WAVE_TABLE_LENGTH);
}

/*! \brief Generate an audio sample
 *
 * \param context The audio context
 */
fix16 synth_waveform_sample(voice_t* voice, fix16 pitch_bend);

fix16 synth_waveform_noise();

static fix16 sine_wave_table[WAVE_TABLE_LENGTH] = {
    0,      804,    1608,   2412,   3215,   4018,   4821,   5622,   6423,
    7223,   8022,   8819,   9616,   10410,  11204,  11995,  12785,  13573,
    14359,  15142,  15923,  16702,  17479,  18253,  19024,  19792,  20557,
    21319,  22078,  22833,  23586,  24334,  25079,  25820,  26557,  27291,
    28020,  28745,  29465,  30181,  30893,  31600,  32302,  32999,  33692,
    34379,  35061,  35738,  36409,  37075,  37736,  38390,  39039,  39682,
    40319,  40950,  41575,  42194,  42806,  43412,  44011,  44603,  45189,
    45768,  46340,  46906,  47464,  48015,  48558,  49095,  49624,  50146,
    50660,  51166,  51665,  52155,  52639,  53114,  53581,  54040,  54491,
    54933,  55368,  55794,  56212,  56621,  57022,  57414,  57797,  58172,
    58538,  58895,  59243,  59583,  59913,  60235,  60547,  60850,  61144,
    61429,  61705,  61971,  62228,  62475,  62714,  62942,  63162,  63371,
    63571,  63762,  63943,  64115,  64276,  64428,  64571,  64703,  64826,
    64939,  65043,  65136,  65220,  65294,  65358,  65412,  65457,  65491,
    65516,  65531,  65535,  65531,  65516,  65491,  65457,  65412,  65358,
    65294,  65220,  65136,  65043,  64939,  64826,  64703,  64571,  64428,
    64276,  64115,  63943,  63762,  63571,  63371,  63162,  62942,  62714,
    62475,  62228,  61971,  61705,  61429,  61144,  60850,  60547,  60235,
    59913,  59583,  59243,  58895,  58538,  58172,  57797,  57414,  57022,
    56621,  56212,  55794,  55368,  54933,  54491,  54040,  53581,  53114,
    52639,  52155,  51665,  51166,  50660,  50146,  49624,  49095,  48558,
    48015,  47464,  46906,  46340,  45768,  45189,  44603,  44011,  43412,
    42806,  42194,  41575,  40950,  40319,  39682,  39039,  38390,  37736,
    37075,  36409,  35738,  35061,  34379,  33692,  32999,  32302,  31600,
    30893,  30181,  29465,  28745,  28020,  27291,  26557,  25820,  25079,
    24334,  23586,  22833,  22078,  21319,  20557,  19792,  19024,  18253,
    17479,  16702,  15923,  15142,  14359,  13573,  12785,  11995,  11204,
    10410,  9616,   8819,   8022,   7223,   6423,   5622,   4821,   4018,
    3215,   2412,   1608,   804,    0,      -804,   -1608,  -2412,  -3215,
    -4018,  -4821,  -5622,  -6423,  -7223,  -8022,  -8819,  -9616,  -10410,
    -11204, -11995, -12785, -13573, -14359, -15142, -15923, -16702, -17479,
    -18253, -19024, -19792, -20557, -21319, -22078, -22833, -23586, -24334,
    -25079, -25820, -26557, -27291, -28020, -28745, -29465, -30181, -30893,
    -31600, -32302, -32999, -33692, -34379, -35061, -35738, -36409, -37075,
    -37736, -38390, -39039, -39682, -40319, -40950, -41575, -42194, -42806,
    -43412, -44011, -44603, -45189, -45768, -46340, -46906, -47464, -48015,
    -48558, -49095, -49624, -50145, -50660, -51166, -51665, -52155, -52639,
    -53114, -53581, -54040, -54491, -54933, -55368, -55794, -56212, -56621,
    -57022, -57414, -57797, -58172, -58538, -58895, -59243, -59583, -59913,
    -60235, -60547, -60850, -61144, -61429, -61705, -61971, -62228, -62475,
    -62714, -62942, -63162, -63371, -63571, -63762, -63943, -64115, -64276,
    -64428, -64571, -64703, -64826, -64939, -65043, -65136, -65220, -65294,
    -65358, -65412, -65457, -65491, -65516, -65531, -65535, -65531, -65516,
    -65491, -65457, -65412, -65358, -65294, -65220, -65136, -65043, -64939,
    -64826, -64703, -64571, -64428, -64276, -64115, -63943, -63762, -63571,
    -63371, -63162, -62942, -62714, -62475, -62228, -61971, -61705, -61429,
    -61144, -60850, -60547, -60235, -59913, -59583, -59243, -58895, -58538,
    -58172, -57797, -57414, -57022, -56621, -56212, -55794, -55368, -54933,
    -54491, -54040, -53581, -53114, -52639, -52155, -51665, -51166, -50660,
    -50145, -49624, -49095, -48558, -48015, -47464, -46906, -46340, -45768,
    -45189, -44603, -44011, -43412, -42806, -42194, -41575, -40950, -40319,
    -39682, -39039, -38390, -37736, -37075, -36409, -35738, -35061, -34379,
    -33692, -32999, -32302, -31600, -30893, -30181, -29465, -28745, -28020,
    -27291, -26557, -25820, -25079, -24334, -23586, -22833, -22078, -21319,
    -20557, -19792, -19024, -18253, -17479, -16702, -15923, -15142, -14359,
    -13573, -12785, -11995, -11204, -10410, -9616,  -8819,  -8022,  -7223,
    -6423,  -5622,  -4821,  -4018,  -3215,  -2412,  -1608,  -804};

static fix16 triangle_wave_table[WAVE_TABLE_LENGTH] = {
    -65536, -65024, -64512, -64000, -63488, -62976, -62464, -61952, -61440,
    -60928, -60416, -59904, -59392, -58880, -58368, -57856, -57344, -56832,
    -56320, -55808, -55296, -54784, -54272, -53760, -53248, -52736, -52224,
    -51712, -51200, -50688, -50176, -49664, -49152, -48640, -48128, -47616,
    -47104, -46592, -46080, -45568, -45056, -44544, -44032, -43520, -43008,
    -42496, -41984, -41472, -40960, -40448, -39936, -39424, -38912, -38400,
    -37888, -37376, -36864, -36352, -35840, -35328, -34816, -34304, -33792,
    -33280, -32768, -32256, -31744, -31232, -30720, -30208, -29696, -29184,
    -28672, -28160, -27648, -27136, -26624, -26112, -25600, -25088, -24576,
    -24064, -23552, -23040, -22528, -22016, -21504, -20992, -20480, -19968,
    -19456, -18944, -18432, -17920, -17408, -16896, -16384, -15872, -15360,
    -14848, -14336, -13824, -13312, -12800, -12288, -11776, -11264, -10752,
    -10240, -9728,  -9216,  -8704,  -8192,  -7680,  -7168,  -6656,  -6144,
    -5632,  -5120,  -4608,  -4096,  -3584,  -3072,  -2560,  -2048,  -1536,
    -1024,  -512,   0,      512,    1024,   1536,   2048,   2560,   3072,
    3584,   4096,   4608,   5120,   5632,   6144,   6656,   7168,   7680,
    8192,   8704,   9216,   9728,   10240,  10752,  11264,  11776,  12288,
    12800,  13312,  13824,  14336,  14848,  15360,  15872,  16384,  16896,
    17408,  17920,  18432,  18944,  19456,  19968,  20480,  20992,  21504,
    22016,  22528,  23040,  23552,  24064,  24576,  25088,  25600,  26112,
    26624,  27136,  27648,  28160,  28672,  29184,  29696,  30208,  30720,
    31232,  31744,  32256,  32768,  33280,  33792,  34304,  34816,  35328,
    35840,  36352,  36864,  37376,  37888,  38400,  38912,  39424,  39936,
    40448,  40960,  41472,  41984,  42496,  43008,  43520,  44032,  44544,
    45056,  45568,  46080,  46592,  47104,  47616,  48128,  48640,  49152,
    49664,  50176,  50688,  51200,  51712,  52224,  52736,  53248,  53760,
    54272,  54784,  55296,  55808,  56320,  56832,  57344,  57856,  58368,
    58880,  59392,  59904,  60416,  60928,  61440,  61952,  62464,  62976,
    63488,  64000,  64512,  65024,  65536,  65024,  64512,  64000,  63488,
    62976,  62464,  61952,  61440,  60928,  60416,  59904,  59392,  58880,
    58368,  57856,  57344,  56832,  56320,  55808,  55296,  54784,  54272,
    53760,  53248,  52736,  52224,  51712,  51200,  50688,  50176,  49664,
    49152,  48640,  48128,  47616,  47104,  46592,  46080,  45568,  45056,
    44544,  44032,  43520,  43008,  42496,  41984,  41472,  40960,  40448,
    39936,  39424,  38912,  38400,  37888,  37376,  36864,  36352,  35840,
    35328,  34816,  34304,  33792,  33280,  32768,  32256,  31744,  31232,
    30720,  30208,  29696,  29184,  28672,  28160,  27648,  27136,  26624,
    26112,  25600,  25088,  24576,  24064,  23552,  23040,  22528,  22016,
    21504,  20992,  20480,  19968,  19456,  18944,  18432,  17920,  17408,
    16896,  16384,  15872,  15360,  14848,  14336,  13824,  13312,  12800,
    12288,  11776,  11264,  10752,  10240,  9728,   9216,   8704,   8192,
    7680,   7168,   6656,   6144,   5632,   5120,   4608,   4096,   3584,
    3072,   2560,   2048,   1536,   1024,   512,    0,      -512,   -1024,
    -1536,  -2048,  -2560,  -3072,  -3584,  -4096,  -4608,  -5120,  -5632,
    -6144,  -6656,  -7168,  -7680,  -8192,  -8704,  -9216,  -9728,  -10240,
    -10752, -11264, -11776, -12288, -12800, -13312, -13824, -14336, -14848,
    -15360, -15872, -16384, -16896, -17408, -17920, -18432, -18944, -19456,
    -19968, -20480, -20992, -21504, -22016, -22528, -23040, -23552, -24064,
    -24576, -25088, -25600, -26112, -26624, -27136, -27648, -28160, -28672,
    -29184, -29696, -30208, -30720, -31232, -31744, -32256, -32768, -33280,
    -33792, -34304, -34816, -35328, -35840, -36352, -36864, -37376, -37888,
    -38400, -38912, -39424, -39936, -40448, -40960, -41472, -41984, -42496,
    -43008, -43520, -44032, -44544, -45056, -45568, -46080, -46592, -47104,
    -47616, -48128, -48640, -49152, -49664, -50176, -50688, -51200, -51712,
    -52224, -52736, -53248, -53760, -54272, -54784, -55296, -55808, -56320,
    -56832, -57344, -57856, -58368, -58880, -59392, -59904, -60416, -60928,
    -61440, -61952, -62464, -62976, -63488, -64000, -64512, -65024};

// TODO: feels like too much power in here - scale all these values down somewhat
// seems relatively louder
static fix16 saw_wave_table[WAVE_TABLE_LENGTH] = {
    -65536, -65280, -65024, -64768, -64512, -64256, -64000, -63744, -63488,
    -63232, -62976, -62720, -62464, -62208, -61952, -61696, -61440, -61184,
    -60928, -60672, -60416, -60160, -59904, -59648, -59392, -59136, -58880,
    -58624, -58368, -58112, -57856, -57600, -57344, -57088, -56832, -56576,
    -56320, -56064, -55808, -55552, -55296, -55040, -54784, -54528, -54272,
    -54016, -53760, -53504, -53248, -52992, -52736, -52480, -52224, -51968,
    -51712, -51456, -51200, -50944, -50688, -50432, -50176, -49920, -49664,
    -49408, -49152, -48896, -48640, -48384, -48128, -47872, -47616, -47360,
    -47104, -46848, -46592, -46336, -46080, -45824, -45568, -45312, -45056,
    -44800, -44544, -44288, -44032, -43776, -43520, -43264, -43008, -42752,
    -42496, -42240, -41984, -41728, -41472, -41216, -40960, -40704, -40448,
    -40192, -39936, -39680, -39424, -39168, -38912, -38656, -38400, -38144,
    -37888, -37632, -37376, -37120, -36864, -36608, -36352, -36096, -35840,
    -35584, -35328, -35072, -34816, -34560, -34304, -34048, -33792, -33536,
    -33280, -33024, -32768, -32512, -32256, -32000, -31744, -31488, -31232,
    -30976, -30720, -30464, -30208, -29952, -29696, -29440, -29184, -28928,
    -28672, -28416, -28160, -27904, -27648, -27392, -27136, -26880, -26624,
    -26368, -26112, -25856, -25600, -25344, -25088, -24832, -24576, -24320,
    -24064, -23808, -23552, -23296, -23040, -22784, -22528, -22272, -22016,
    -21760, -21504, -21248, -20992, -20736, -20480, -20224, -19968, -19712,
    -19456, -19200, -18944, -18688, -18432, -18176, -17920, -17664, -17408,
    -17152, -16896, -16640, -16384, -16128, -15872, -15616, -15360, -15104,
    -14848, -14592, -14336, -14080, -13824, -13568, -13312, -13056, -12800,
    -12544, -12288, -12032, -11776, -11520, -11264, -11008, -10752, -10496,
    -10240, -9984,  -9728,  -9472,  -9216,  -8960,  -8704,  -8448,  -8192,
    -7936,  -7680,  -7424,  -7168,  -6912,  -6656,  -6400,  -6144,  -5888,
    -5632,  -5376,  -5120,  -4864,  -4608,  -4352,  -4096,  -3840,  -3584,
    -3328,  -3072,  -2816,  -2560,  -2304,  -2048,  -1792,  -1536,  -1280,
    -1024,  -768,   -512,   -256,   0,      256,    512,    768,    1024,
    1280,   1536,   1792,   2048,   2304,   2560,   2816,   3072,   3328,
    3584,   3840,   4096,   4352,   4608,   4864,   5120,   5376,   5632,
    5888,   6144,   6400,   6656,   6912,   7168,   7424,   7680,   7936,
    8192,   8448,   8704,   8960,   9216,   9472,   9728,   9984,   10240,
    10496,  10752,  11008,  11264,  11520,  11776,  12032,  12288,  12544,
    12800,  13056,  13312,  13568,  13824,  14080,  14336,  14592,  14848,
    15104,  15360,  15616,  15872,  16128,  16384,  16640,  16896,  17152,
    17408,  17664,  17920,  18176,  18432,  18688,  18944,  19200,  19456,
    19712,  19968,  20224,  20480,  20736,  20992,  21248,  21504,  21760,
    22016,  22272,  22528,  22784,  23040,  23296,  23552,  23808,  24064,
    24320,  24576,  24832,  25088,  25344,  25600,  25856,  26112,  26368,
    26624,  26880,  27136,  27392,  27648,  27904,  28160,  28416,  28672,
    28928,  29184,  29440,  29696,  29952,  30208,  30464,  30720,  30976,
    31232,  31488,  31744,  32000,  32256,  32512,  32768,  33024,  33280,
    33536,  33792,  34048,  34304,  34560,  34816,  35072,  35328,  35584,
    35840,  36096,  36352,  36608,  36864,  37120,  37376,  37632,  37888,
    38144,  38400,  38656,  38912,  39168,  39424,  39680,  39936,  40192,
    40448,  40704,  40960,  41216,  41472,  41728,  41984,  42240,  42496,
    42752,  43008,  43264,  43520,  43776,  44032,  44288,  44544,  44800,
    45056,  45312,  45568,  45824,  46080,  46336,  46592,  46848,  47104,
    47360,  47616,  47872,  48128,  48384,  48640,  48896,  49152,  49408,
    49664,  49920,  50176,  50432,  50688,  50944,  51200,  51456,  51712,
    51968,  52224,  52480,  52736,  52992,  53248,  53504,  53760,  54016,
    54272,  54528,  54784,  55040,  55296,  55552,  55808,  56064,  56320,
    56576,  56832,  57088,  57344,  57600,  57856,  58112,  58368,  58624,
    58880,  59136,  59392,  59648,  59904,  60160,  60416,  60672,  60928,
    61184,  61440,  61696,  61952,  62208,  62464,  62720,  62976,  63232,
    63488,  63744,  64000,  64256,  64512,  64768,  65024,  65280};

#endif